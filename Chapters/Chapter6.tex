% Chapter Template

\chapter{Analysis of Feed Forward Derating Control Scheme With SOWFA.} % Main chapter title

\label{Chapter6} % Change X to a consecutive number; for referencing this chapter elsewhere, use \ref{ChapterX}


%----------------------------------------------------------------------------------------
%	SECTION 1
%----------------------------------------------------------------------------------------

\section{Introduction} \label{section6-1}

Chapter \ref{Chapter4} investigated the benefits and feasibility of derating a downwind turbine based on a feed forward signal from an upwind turbine. The feed forward derating control scheme developed in chapter 4 monitors the rotor speed of the upwind turbine for large rotor overspeeds, which are indicative of large wind gusts. When those large rotor overspeeds are detected, the downwind turbine is smoothly transitioned to derated operation until the gust passes. Derating a turbine reduces power generation, but also decreases both structural loads and rotor speed, making that turbine less sensitive to the detrimental effects of a large wind gust. By derating the downwind turbine only when the upwind turbine detects a large wind gust, the downwind turbine gains the benefits of derating (reduced loads and overspeeds) when they are needed most while keeping the cost of derating (reduced energy generation) in check.

The control scheme was evaluated using a series of FAST simulations, which showed promising results (Section \ref{section4-6}). The control scheme reduced peak structural loads and damage equivalent loads (DEL) while decreasing rotor overspeeds enough to avoid emergency shutdowns of the downwind turbine. The control scheme did reduce electricity generation, but the reduction was small and would likely be much less than the power lost in an emergency turbine shutdown. Though these results are promising, the simulation methodology used to generate them has several noteworthy limitations. First, these simulations did not model emergency turbine shutdowns due to rotor overspeeds. Second, to simulate this system in FAST we had to assume Taylor's frozen turbulence hypothesis, which provides a very simplistic model of wind speed fluctuations passing through the wind farm. As a result, the simulations did not capture the evolution of the gust as it passes from the upwind turbine to the downwind turbine, it did not capture turbine wake effects, and it did not accurately capture the time it takes for the gust to travel from the upwind turbine to the downwind turbine. In this chapter we will evaluate the control scheme developed in Chapter \ref{Chapter4} using a simulation tool that does not have these limitations.

As discussed in Chapter \ref{Chapter5}, the Simulator fOr Wind Farm Applications (SOWFA) is  wind farm simulation tool. SOWFA uses FAST to model the dynamics of one or more turbines, a Large Eddy Simulation (LES) to model atmospheric airflow, and actuator line models to enable interaction of the LES and FAST models. Because SOWFA models atmospheric airflow, we can use it to design a simulation that will capture the evolution of a gust over time, wake effects, and the time it takes a gust to reach the downwind turbine. We can also add control logic that will capture the effects of emergency turbine shutdowns due to rotor overspeed. In Chapter \ref{Chapter5} SOWFA simulations of the NREL 5MW rotor were compared to Reynolds Averaged Navier Stokes (RANS) simulaions of the same rotor and were found to yield similar results. In addition, several SOWFA simulation parameters were varied to investigate the tradeoffs between simulation accuracy and computational cost. Because of the work documented in Chapter \ref{Chapter5} we have confidence in the accuracy of SOWFA simulations and a good understanding of how to achieve accurate results at an acceptable computational cost.

Sections \ref{section6-2} through \ref{section6-5} describe much of the background work that had to be done before SOWFA simulations of the feed forward selective derating scheme could be carried out. They discuss topics such as implementation of the turbine controller, tuning and validation of the SOWFA turbine model, modeling gusts in SOWFA, as well as choosing an appropriate LES grid resolution and computational domain. Section \ref{section6-6} presents the first simulation case, in which the downwind turbine is directly behind the upwind turbine and in it's wake. Section \ref{section6-7} presents the second simulation case, in which the turbines are offset slightly so that the downwind turbine isn't in the wake of the upwind turbine. Section \ref{section6-8} summarizes this chapter and it's findings.



%----------------------------------------------------------------------------------------
%	SECTION 2
%----------------------------------------------------------------------------------------

\section{Controller Implementation} \label{section6-2}

The simulations carried out in Chapter \ref{Chapter4} use Simulink and Matlab to model control systems. Individual turbine control, such as determining the appropriate blade pitch and generator torque, is modeled in Simulink. Plant level control, such as monitoring the upwind turbine and determining when to derate the downwind turbine, is modeled in Matlab scripts. This method has several bennefits. First, Simulink and Matlab are user friendly programming languages.  They include a large number of pre-programmed functions and subsystems that make controller implementation easier. Second, these Simulink and Matlab controllers are not part of the FAST executable file. Therefore, changing the controller does not require recompiling FAST. This can save a lot of time and effort, especially when a new control system is being developed, tested, and tuned. 

Unfortunately, the same controller implementation can not be used for SOWFA simulations. Though SOWFA does use FAST to model turbine dynamics, it uses a modified version of FAST that is compiled for Linux operating systems and does not have the ability to interface with Simulink. To overcome this limitation the Simulink controller developed in Chapter \ref{Chapter4} is re-written as a set of fortran subroutines and inserted into the SOWFA/FAST source code. FAST and SOWFA are then recompiled to implement the turbine control system developed in chapter 4. 

Fortran subroutines PitchCntrl() and UserVSCont() implement the collective pitch and generator torque controll. Subroutine updateControlParameters() implements a low pass filter on generator speed and scales control parameters to transition the turbine into and out of derated operation. Subroutine UserHSSBr() models a brake that can be used to park the rotor at the end of an emergency shutdown. All four subroutines are in file UserSubs.f90. Module EAControl(), in FAST\textunderscore Mods.f90, stores variables that are accessed by multiple control subroutines. FAST\textunderscore IO.f90 has been modified so information that a turbine would recieve from a plant level controller, such as when to derate the turbine, can be read in as part of the input file primary.fst. The source code containing this controller implementation is available in the github repository https://github.com/ewandersonUCDavis/SOWFA\textunderscore openFAST\textunderscore EA.git.    

The simulations carried out in Chapter \ref{Chapter4} did not model emergency turbine shutdowns due to rotor overspeeds. However, these events are important. Energency shutdowns reduce power generation and can dramatically affect a turbine's wake. To ensure those effects are captured in our SOWFA simulations, emergency shutdown functionality was added to the turbine controller. The NREL 5MW turbine specification does not describe an emergency shutdown protocol\cite{jonkman2009}, so an emergency shutdown protocol was implemented based on the "aerodynamic shutdown" process described by Pedersen and Steineche \cite{pedersen2012}. If the turbine experiences a rotor overspeed in excess of 15\% an emergency shutdown is initiated. The emergency shutdown protocol overrides the pitch and generator torque controllers. Generator torque is turned off and the turbine blades are collectively pitched to 90$^{\circ}$ at a rate of 8$^{\circ}$ per second. The pitched blades induce aerodynamic braking, which rapidly slows the turbine rotor. When the rotor is almost completely stopped a high speed shaft brake is initiated to ensure the rotor comes to a complete stop and remains stationary.

Plant level control can not be modeled in SOWFA at this time. Though NREL did develop a version of SOWFA capable of modeling plant level control \cite{fleming2013,fleming2013a} it was never released publicly and is currently unavailable. For the simulations carried out in this chapter plant level control will be implemented outside of SOWFA. This is accomplished by running each simulation twice. First the simulation is run without plant level control. The results of the first simulation provide a performance baseline and allow plant level control signals to be generated offline. The second simulation is run with plant level control. Plant level control signals (when to derate the downwind turbine and by how much) are fed to the downwind turbine through the input file primary.fst. Results from the second simulation can be compared to results from the first simulation to determine how the plant level controller affects system performance. 

%----------------------------------------------------------------------------------------
%	SECTION 3
%----------------------------------------------------------------------------------------

\section{Computational Domain and Grid Resolution} \label{section6-3}

The LES computational domain used in this chapter is 5040 meters $\times$ 2520 meters $\times$ 2520 meters. As in chapter \ref{Chapter5} this rectangular grid is initially composed of 32 m $\times$ 32 m $\times$ 32m cells, but portions of the domain are refined to decrease cell size near the turbine rotors and their wakes. Two configurations will be simulated, as illustrated in figure \ref{fig6-1}. In the first configuration the upwind turbine will be 10 rotor diameters (1260 meters) downstream of the center of the inlet while the downwind turbine is 10 rotor diameters further downstream. In this configuration the downwind turbine will be in the wake of the upwind turbine. The second configuration is similar, but each turbine is offset horizontally by 0.75 rotor diameter so the downwind turbine is not in the wake of the upwind turbine. 

\begin{figure}[htbp]	\label{fig6-1}
	\centering
		\includegraphics[width = \linewidth]{Figures/ch6Figures/fig6-1.png}
		\rule{35em}{0.5pt}
	\caption{Configurations for SOWFA simulations of feed forward derating control.}
\end{figure}

Choosing a grid resolution is a compromise. A fine grid captures flow behavior that coarse grids doesn't capture. However, using a fine grid has a higher computational cost than a coarse grid, requiring more cores and/or more time to run a simulation. One way to balance simulation detail and computational cost is to make the grid resolution finer in the areas you are most interested in (such as near the turbine rotor) and coarser in areas that are of less interest (such as far from the turbine). Another way is to make the grid resolution as fine as it needs to be, but not making it any finer. 

For simulations in Section \ref{section5-4-1} (referencing a chapter 5 section that hasn't been inserted yet) a grid resolution of 1 meter was used near the turbine rotor. This near-rotor grid was not very large, extending only 1 rotor diameter upstream, 6 rotor diameters downstream, and 1.4 rotor diameters radially, which is approximately 0.04\% of the simulation domain volume. However, this near-rotor grid contains approximately 11 million cells, which is about 57\% of the cells in the simulation domain. A 1 m $\times$ 1 m $\times$ 1 m grid large enough to encompass the two turbine systems shown in figure \ref{fig6-1} would have a prohibitively large number of cells and have a prohibitively high computational cost. 

To make the computational cost more manageable a 2 meter near-rotor grid resolution will be used for simulations in this chapter. Though simulation results will be less detailed, we still have high confidence in the accuracy of the results. As Section \ref{section5-4-3} shows, even a near-rotor grid resolution of 4 meters yielded good agreement for power generation, rotor thrust, wake vorticity, and momentum deficit.  

%----------------------------------------------------------------------------------------
%	SECTION 4
%----------------------------------------------------------------------------------------

\section{Tuning and Validation of SOWFA Turbine Model} \label{section6-4}

An actuator line model couples SOWFA's LES based atmosphere model to SOWFA's FAST based turbine dynamics model. To get accurate turbine performance from SOWFA, the actuator line model must be tuned. A series of simulations revealed that an actuator line model with 62 elements per blade and a Gausian projection width of 7.5 meters yields good agreement between SOWFA and FAST simulations. These actuator line parameters comply with the best practices recommended by Churchfield, Lee, and Moriarty \cite{churchfield2012} as well as those recommended by Troldborg \cite{troldborg2009}. It is worth noting that the Gausian projection width chosen here is different than the one chosen for SOWFA simulations in Chapter \ref{Chapter5}. This difference is partially due to the use of a 2 meter near-rotor grid resolution, but it is also caused by a difference in tuning requirements. The SOWFA simulations carried out in Chapter \ref{Chapter5} did not model turbine control, so the actuator line was only tuned to produce good agreement on turbine loads and power generation. The Gausian projection width chosen here produces good agreement on controller behavior as well as loading and power generation for wind speeds between 12 and 25 m/s (the range of wind speeds for which the turbine is operating in region 3 control).

To illustrate the close agreement between SOWFA and FAST simulations three simple test cases from chapter 4 are simulated in SOWFA. In these test cases the turbine is subjected to a constant, uniform wind. At 100 seconds the turbine is derated by 20\%. At 200 seconds the turbine is returned to full rated operation. Incoming wind speeds of 12 m/s, 16 m/s, and 20 m/s are simulated. Figures \ref{fig6-2} through \ref{fig6-6} show FAST and SOWFA simulation results for the 16 m/s test case. We see in the figures that FAST and SOWFA produce nearly identical results for rotor speed, power, and blade root bending moments. There is also good agreement on blade pitch and tower base bending moment. SOWFA predicts slightly lower blade pitch angels for this case with a maximum discrepancy of 2.0\% (or 0.25\degree) at 217 seconds. As shown in Figure \ref{fig6-6}, SOWFA predicts more high frequency oscillations in tower base bending moment than FAST. However, there is close agreement on the magnitudes of the predicted loads. 

\begin{figure}[htbp]	\label{fig6-2}
	\centering
		\includegraphics[trim = {1cm 0 2cm 0}, clip, width = \linewidth]{Figures/ch6Figures/fig6-2.png}
		\rule{35em}{0.5pt}
	\caption{Comparison of rotor speed predicted by FAST and SOWFA.}
\end{figure}

\begin{figure}[htbp]	\label{fig6-3}
	\centering
		\includegraphics[trim = {1cm 0 2cm 0}, clip, width = \linewidth]{Figures/ch6Figures/fig6-3.png}
		\rule{35em}{0.5pt}
	\caption{Comparison of power predicted by FAST and SOWFA.}
\end{figure}

\begin{figure}[htbp]	\label{fig6-4}
	\centering
		\includegraphics[trim = {1cm 0 2cm 0}, clip, width = \linewidth]{Figures/ch6Figures/fig6-4.png}
		\rule{35em}{0.5pt}
	\caption{Comparison of blade pitch predicted by FAST and SOWFA.}
\end{figure}

\begin{figure}[htbp]	\label{fig6-5}
	\centering
		\includegraphics[trim = {1cm 0 2cm 0}, clip, width = \linewidth]{Figures/ch6Figures/fig6-5.png}
		\rule{35em}{0.5pt}
	\caption{Comparison of blade blade root bending moment predicted by FAST and SOWFA.}
\end{figure}

\begin{figure}[htbp]	\label{fig6-6}
	\centering
		\includegraphics[trim = {1cm 0 2cm 0}, clip, width = \linewidth]{Figures/ch6Figures/fig6-6.png}
		\rule{35em}{0.5pt}
	\caption{Comparison of tower base bending moment predicted by FAST and SOWFA.}
\end{figure}



Figures \ref{fig6-7} and \ref{fig6-8} show the blade pitch predicted by FAST and SOWFA for the  12 m/s and 20 m/s test cases. For these cases, like the 16 m/s case, FAST and SOWFA had nearly identical predictions for rotor speed, power, and blade root bending moments. We see in Figure \ref{fig6-7} that SOWFA predicts a slightly larger blade pitch when the turbine is operating at full rated capacity in 12 m/s wind. The discrepancy is approximately 0.25\degree . SOWFA also predicts less oscillation in blade pitch following transitions into and out of derated operation. The Despite these discrepancies I still consider this good agreement and evidence of a well tuned SOWFA actuator line model.   


??????? ADD TEXT AND FIGURES ABOUT TWR MOMENT TOO   ?????? 



\begin{figure}[htbp] \label{fig6-7}
	\centering
		\includegraphics[trim = {1cm 0 2cm 0}, clip, width = \linewidth]{Figures/ch6Figures/fig6-7.png}
		\rule{35em}{0.5pt}
	\caption{Comparison of blade pitch predicted by FAST and SOWFA for a turbine in 12 m/s winds that is derated by 20\%.}
\end{figure}

\begin{figure}[htbp]	\label{fig6-8}
	\centering
		\includegraphics[trim = {1cm 0 2cm 0}, clip, width = \linewidth]{Figures/ch6Figures/fig6-p.png}
		\rule{35em}{0.5pt}
	\caption{Comparison of blade pitch predicted by FAST and SOWFA for a turbine in 20 m/s winds that is derated by 20\%}
\end{figure}

%----------------------------------------------------------------------------------------
%	SECTION 5
%----------------------------------------------------------------------------------------

\section{Gust Modeling in SOWFA} \label{section6-5}

For the FAST simulations in Chapter \ref{Chapter4} gusts are modeled by simply increasing the incoming wind speed. However, this method does not work in SOWFA. SOWFA models airflow as an incompressible fluid in a finite computational domain. Increasing the wind speed across the inlet would cause an increase in the amount of air flowing into the computational domain. Because the fluid is incompressible and constrained, conservation of mass dictates that an increase in the amount of air flowing into the domain be immediately matched by an increase in the amount of air flowing out of the domain and an increase in the amount of air flowing from the input to the output. Therefore, increasing the wind speed across the inlet of the computational domain causes an instantaneous increase in wind speed throughout the computational domain.

To model a gust propagating through a wind farm we must be more subtle. This is done by increasing wind speed across part of the inlet, while decreasing wind speed elsewhere in the inlet. As long as the total amount of air flowing into the domain remains the same, the flow far downstream of the inlet will not be affected. Using this method, the gust is localized near the inlet initially then propagates through the computational domain over time. 

In SOWFA, the user can specify a time varying velocity profile across the inlet by applying a TimeVaryingMappedFixedValue boundary condition. For this boundary condition, the user specifies a list of locations on the inlet plane, then specifying velocities at those points for several simulation times. SOWFA interpolates between the supplied data to determine the velocity profile across the inlet for all time steps in the simulation.

Several inlet velocity profiles were investigated in a series of preliminary SOWFA simulations. The inlet profile was found to have a large effect on how the gust initially appears in the simulation domain and how it behaves as it propagates through the domain. Inlet profiles that confine the gust to a small portion of the inlet were found to give the most control over gust behavior. When the gust covers a large portion of the inlet profile, SOWFA smooths out the effect of the gust. This smoothing effect turns rapid velocity changes at the inlet into more gradual velocity changes within the simulation domain. In the following sections we use inlet profiles that confine the gust to a small portion of the inlet. On the remainder of the inlet, the velocity remains constant. 

In chapter \ref{Chapter4} the turbines were subjected to a hat shaped Extreme Operating Gust as defined in section 6.3.2.2 of IEC61400-1\cite{IEC2005}. Preliminary SOWFA simulations found that it is not possible to simulate a hat shaped gust that will propagate through the SOWFA simulations domain. A hat shaped fluctuation of the inlet velocity begins as a hat shaped gust near the inlet. However, the gust decreased in magnitude and changed shape as it moved through the simulation domain. Instead, simulations in the following sections will model an Extreme Coherent Gust similar to the one defined in section 6.3.2.5 of IEC61400-1. 

Figure \ref{fig6-11} illustrates the difference between an Extreme Operating Gust (EOG) and an Extreme Coherent Gust (ECG). The EOG is a brief fluctuation in wind speed, while the ECG is a sustained increase. IEC1400-1 defines the ECG as a 15 m/s increase in wind speed described by equation \ref{eq6-1}. For simulations in this chapter, the 15 m/s ECG magnitude specified by IEC1400-1 is interpreted to be a maximum coherent gust magnitude, not a required magnitude. If a 15 m/s coherent gust is possible then smaller magnitude coherent gusts are also possible. Coherent gusts were found to propagate through the SOWFA simulation domain with only small changes to the magnitude and shape of the gust, as illustrated in figure \ref{fig6-12}



\begin{figure}[htbp] \label{fig6-11} 
	\centering
		\includegraphics[trim = {1cm 0 2cm 0}, clip, width = \linewidth]{Figures/ch6Figures/fig6-11.png}
		\rule{35em}{0.5pt}
	\caption{Velocity profiles for EOG and ECG.}
%	\label{fig6-11}
\end{figure}

\begin{equation} \label{eq6-1}
	U_{gust}=\left\{\begin{matrix}
0 & for  & t<t_{gust}\\ 
 7.5(1-cos(\pi t/10)) m/s & for  & t_{gust} \leq t<(t_{gust}+10)\\ 
 15 m/s &  for & \leq (t_{gust} +10)
\end{matrix}\right. 
\end{equation}

\begin{figure}[htbp] \label{fig6-12}
	\centering
		\includegraphics[trim = {1cm 0 2cm 0}, clip, width = \linewidth]{Figures/ch6Figures/fig6-12.png}
		\rule{35em}{0.5pt}
	\caption{Center line velocity as ECG propagates through computational domain.}
\end{figure}

%----------------------------------------------------------------------------------------
%	SECTION 6
%----------------------------------------------------------------------------------------
\section{Offset Turbines Test Case} \label{section6-6}

This section documents SOWFA simulations of the offset turbine test case illustrated in figure \ref{fig6-1}. In this test case one turbine is 20R downwind of and 3R to the side of another turbine, where R is the rotor radius of 63 meters. Because of the 3R offset, the downwind turbine is not in the wake of the upwind turbine. This is the configuration that was assumed for FAST simulations of feed forward derating control carried out in Chapter \ref{chapter4}. 


%-----------------------------------
%	SUBSECTION 6-6-1
%-----------------------------------
\subsection{Simulation Setup} \label{section6-6-1}

The computational domain is 80R (5,040 m) long, extending 20R in front of the upwind turbine and 40R behind the downwind turbine. The domain is 40R tall, extending 20R above and below the turbine rotors. The domain is also 40R. Each rotor is 38.5R from one side and 41.5R from the other side due to the offset between the upwind and downwind turbine. Initially the domain is constructed of cube shaped cells approximately 32 m $\times$ 32 m $\times$ 32 m, but portions of the domain go through a series of grid refinements to reduce the size of cells to approximately 2 m $\times$ 2 m $\times$ 2 m near the rotors. Table \ref{table6-1} describes the dimensions and resolutions of each refinement region. The first three refinement regions are rectangular cuboid shaped regions that encompass both turbines. These refinement regions are centered in the computational domain with respect to width and height. In the streamwise direction refinement regions 1, 2, and 3 begin 8.5R, 4.5R, and 2.5R (respectively) in front of the upwind turbine. Refinement regions 4 and 5 are cylindrical in shape and each encompass one of the two turbines. Each of these cylindrical refinement regions is centered on the rotational axis of a turbine rotor, extending 1.5R in front of and 12R behind the rotor.


\begin{table} \label{Table6-1}
\centering
\caption{ Dimensions and resolutions of the SOWFA grid refinement regions.}
\begin{tabular}{c c c c c}
\hline
Refinement & Streamwise  & Width & Height & Max Cell Size\\
Region & Length(\emph{R}) & (\emph{R})  &  (\emph{R}) & in Region\\
\hline
1 & 68.5\emph{R} (4316 m)  & 20.2\emph{R} (1272 m) & 17.2\emph{R} (1084 m) & 16 m $\times$ 16 m $\times$ 16 m\\
2 & 64.5\emph{R} (4064 m)  & 12.2\emph{R} (768 m) & 8.2\emph{R} (516 m)  & 8 m $\times$ 8 m $\times$ 8 m\\
3 & 46.5\emph{R} (2930 m)  & 8.2\emph{R} (516 m) & 5.2\emph{R} (328 m)  & 4 m $\times$ 4 m $\times$ 4 m\\
\\
4 \& 5 & 13.5\emph{R} (851 m)    & \multicolumn{2}{c}{Radius = 1.6\emph{R} (101 m)}   & 2 m $\times$ 2 m $\times$ 2 m\\
\hline
\end{tabular}
\end{table}

Each simulation is 700 seconds long, but the first 300 seconds are disregarded. This is to ensure that both turbines and their wakes have reached steady state before we start collecting data. Initially the inlet of the computational domain has a uniform 12 m/s wind speed. At 400 seconds a coherent gust is introduced in the center of the computational domain inlet. 

The coherent gust used in the offset turbine test case is 567 m tall $\times$ 756 m wide and is illustrated in Figure \ref{fig6-13}. This is essentially a round gust that has been elongated by 3R (189 m) to ensure it encompasses both turbines. For the part of the gust between the rotor centerlines,  wind speed is given by equation \ref{eq6-2}, where $h_g$ is the distance above or below the rotor centerlines. For the part of the gust to the left or right of the rotor center lines, wind speed is given by equation \ref{eq6-3}, where $r_g$ is the radial distance from the closest rotor centerline. As discussed in Section \ref{section6-5}, the coherent gust contains both higher speed regions (up to 26.16 m/s) and lower speed regions (as low as 5.11 m/s) so the average wind speed across the computational domain inlet remains 12 m/s. For the regions directly upwind of each rotor the average wind speed durring the extreme operating gust is 25 m/s, which is the upper limit of the NREL 5MW turbine operating range. 

\begin{figure}[htbp] \label{fig6-13} 
	\centering
		\includegraphics[width = \linewidth]{Figures/ch6Figures/fig6-13.png}
		\rule{35em}{0.5pt}
	\caption{Wind speed near center of inlet during Extreme Coherent Gust (offset turbine test case).}
%	\label{fig6-13}
\end{figure}

\begin{equation} \label{eq6-2}
	U_{gust}=\left\{\begin{matrix}
\left [15.6312 +10.5248Cos\left ( \frac{h_g}{252 }\pi  \right )  \right ]m/s & for  & h_g<252\\ 
 \left [8.5532 -3.4468Cos\left ( \frac{h_g-252}{31.5}\pi  \right )  \right ]m/s & for  & 252 \leq h_g <283.5\\ 
 12 m/s &  for & 283.5 \leq h_g
\end{matrix}\right. 
\end{equation}
\begin{equation} \label{eq6-3}
	U_{gust}=\left\{\begin{matrix}
\left [15.6312 +10.5248Cos\left ( \frac{r_g}{252 }\pi  \right )  \right ]m/s & for  & r_g<252\\ 
 \left [8.5532 -3.4468Cos\left ( \frac{r_g-252}{31.5}\pi  \right )  \right ]m/s & for  & 252 \leq r_g <283.5\\ 
 12 m/s &  for & 283.5 \leq r_g
\end{matrix}\right. 
\end{equation}

%-----------------------------------
%	SUBSECTION 6-6-2
%-----------------------------------
\subsection{Performance Without Feed Forward Derating Control} \label{section6-6-2}

Figure \ref{fig6-14} shows wind speed in the computational domain at several key moments. Each image in Figure \ref{fig6-14} was generated by taking a horizontal cross section through the center of the computational domain then trimming the cross section to remove regions that were far from the turbines in the downwind or horizontal directions. White lines have been superimposed on the images to show the locations and approximate sizes of the turbine rotors. At t=300 s we see the turbines operating in a steady, uniform 12 m/s wind. The wakes of each turbine are clearly visible, and we see that the downwind turbine is not in the wake of the upwind turbine. At t = 400 s the Extreme Coherent Gust enters the computational domain. We see at t = 420 s that the gust has begun to propagate through the domain from left to right. Note that the gust has higer wind speeds at it's center and lower wind speeds near it's edges (as discussed in Section \ref{section6-4}). At t = 480 s we see that the gust has recently reached the upwind turbine. At t = 540 s we see the gust arriving at the downwind turbine. In the t = 540 s image we can also see that there is no wake trailing the upwind turbine. This indicates that the upwind turbine has shut down.
 At t = 660 s we see that the gust has continued to propagate downstream and there is no wake trailing the downwind turbine, which indicates that it has also shut down.
 
 \begin{figure}[htbp] \label{fig6-14} 
	\centering
		\includegraphics[width = \linewidth]{Figures/ch6Figures/fig6-14.png}
		\rule{35em}{0.5pt}
	\caption{Wind speed near center of inlet during Extreme Coherent Gust (offset turbine test case).}
%	\label{fig6-14}
\end{figure}

It's noteworthy that the gust traveled from the upwind turbine to the downwind turbine in approximately 70 seconds. This corresponds to a convection speed of approximately 18 m/s. For many of the simulations carried out in chapters \ref{chapter3} and \ref{chapter4} I assumed Taylor's frozen turbulence hypothesis was valid. I made that assumption because it allowed me to model a two turbine system using FAST, but I noted at the time that the assumption was not expected to be completely valid. If Taylor's frozen turbulence hypothesis was valid for this test case we would expect the gust to propagate downstream at the average domain wind speed of 12 m/s. However, the gust propagates at neither the average wind speed (12 m/s) nor the gust wind speed (~25 m/s), but somewhere in between. This reinforces the importance of using a feed forward control scheme that is tolerant of uncertainty about gust propagation speeds. As discussed in Section \ref{section4-5}, the feed forward selective derating control scheme evaluated in this chapter is highly tolerant of uncertainty in gust propagation speed. The fed forward controller is not required to take any action at the exact moment the gust reaches the downwind turbine. It simply has to derate the turbine some time before the gust arrives and return the turbine to full rated operation some time after the gust has passed.

Figures \ref{fig6-15} through \ref{fig6-19} show the rotor speed, power generation, blade pitch, blade root bending moment, and tower base fore-aft bending moment of the turbines. We see in figures \ref{fig6-15} and \ref{fig6-16} that both turbines have reached steady state operation by t = 300 s. The rotors are turning at a constant rate of 12.1 RPM and both turbines are producing 5 MW. The Extreme Coherent gust reaches the upwind turbine at approximately 450 s, causing both the rotor speed and power generation to increase. At t = 469.7 s the rotor speed exceeds the 15\% overspeed limit and an emergency overspeed shutdown is initiated. The upwind rotor comes to a halt at t = 480.9 s and is stationary for the remaining 219.1 seconds of the simulation. In real world operation this turbine would remain stationary until an operator can verify that is safe to return the turbine to operation. This could potentially be much longer than 219.1 seconds. The Extreme Coherent gust reaches the downwind turbine at approximately 520 s, causing both the rotor speed and power generation to increase. At t = 539.2 s the down wind rotor speed exceeds the 15\% overspeed limit and an emergency overspeed shutdown is initiated. By t = 550.5 seconds both turbines have been shut down and no power is being generated.

\begin{figure}[htbp] \label{fig6-15}
	\centering
		\includegraphics[trim = {1cm 0 2cm 0}, clip, width = \linewidth]{Figures/ch6Figures/fig6-15.png}
		\rule{35em}{0.5pt}
	\caption{Center line velocity as ECG propagates through computational domain.}
\end{figure}
\begin{figure}[htbp] \label{fig6-16}
	\centering
		\includegraphics[trim = {1cm 0 2cm 0}, clip, width = \linewidth]{Figures/ch6Figures/fig6-16.png}
		\rule{35em}{0.5pt}
	\caption{Center line velocity as ECG propagates through computational domain.}
\end{figure}

Figure \ref{fig6-17} shows the blade pitch of the turbines. Initially, when the turbines are operating in uniform 12 m/s wind both turbines have a steady blade pitch of 4.8\degree. As each turbine begins to experience increased wind speed it's blade pitch increases. This is an effort by the turbine pitch controller to maintain a constant rotational speed of 12.1 RPM. We see in Figure \ref{fig6-17} the upwind turbine has a blade pitch of 18.3\degree when the emergency shutdown procedure is initiated at t = 469.7 s. After the emergency shutdown is initiated blade pitch increases to 90\degree at a rate of 8\degree /s. The downwind turbine shows similar behavior, reaching a blade pitch of 20.3\degree before the emergency shutdown is initiated at t = 539.2 s.

\begin{figure}[htbp] \label{fig6-17}
	\centering
		\includegraphics[trim = {1cm 0 2cm 0}, clip, width = \linewidth]{Figures/ch6Figures/fig6-17.png}
		\rule{35em}{0.5pt}
	\caption{Center line velocity as ECG propagates through computational domain.}
\end{figure}

Figures \ref{fig6-18} shows blade root bending moment (BRM). Initially, when the turbines are operating in uniform 12 m/s wind the blade root bending moment is very regular and both turbines experience nearly identical cyclical loading. When the turbines begin to experience higher wind speeds and blade pitch begins to increase, the BRM loading cycle maintains it's shape but begins to decrease in magnitude. This effect is easiest to see in the downwind turbine BRM between t = 500 s and t = 535 s, but it is also present in the upwind turbine BRM from t = 430 s to t = 465 s. Durring the emergency shutdown process the shape of the BRM loading cycle changes and the magnitude of the BRM loading cycle increases. When the rotor comes to a halt the BRM settles to a constant value. Note that BRM is not 0 MNm when the turbine rotor stops. This residual loading is due to gravitational loads. BRM would only be 0 MNm if this blade happened to stop pointing directly up or down.

\begin{figure}[htbp] \label{fig6-18}
	\centering
		\includegraphics[trim = {1cm 0 2cm 0}, clip, width = \linewidth]{Figures/ch6Figures/fig6-18.png}
		\rule{35em}{0.5pt}
	\caption{Center line velocity as ECG propagates through computational domain.}
\end{figure}

In Figure \ref{fig6-19} we see that the tower base fore-aft bending moments is initially constant at approximately 48 MNm. The tower base bending moment is highly dependent on the aerodynamic loading, which is highly dependent on blade pitch. As wind speeds begin to increase and blade pitches begin to increase we see a smooth reduction in tower fore-aft bending moment. The emergency shutdown process introduces a lot more oscillation in the tower base fore-aft bending moment, including one very large loading cycle where loading goes from approximately 35 MNm to approximately -40 MNm. This large spike in negative loading moment corresponds to the tower swinging forward after the aerodynamic loading on the rotor is suddenly reduced to zero when the blades pitch to 90\degree. Eventually all of the high frequency oscillations in loading die out and the tower base fore-aft bending moement settles to 0 MNm.

\begin{figure}[htbp] \label{fig6-19}
	\centering
		\includegraphics[trim = {1cm 0 2cm 0}, clip, width = \linewidth]{Figures/ch6Figures/fig6-19.png}
		\rule{35em}{0.5pt}
	\caption{Center line velocity as ECG propagates through computational domain.}
\end{figure}

Table \ref{table6-2} summarizes several important performance metrics for the turbines. We see that both turbines have very similar tower base fore-aft bending moment Damage Equivalent Loads (DEL). This was expected based on Figure \ref{fig6-19}. Cyclic loading is the primary driver of DEL values (as discussed in Appendix \ref{AppendixC}) and both turbines experience similar tower base fore-aft bending moment cycles. We see that the downwind turbine experiences approximately 20\% higher blade root bending moment DEL. Part of this difference is because the cyclic loading a turbine blade experiences during normal operation and the fact that the downwind turbine operates for longer before it experiences an emergency shutdown. A contributing factor may also be the differences in the loading patterns observed near shutdown in Figure \ref{fig6-18}. These differences in loading patterns are caused by the interaction of the loading induced by the extremem coherent gust and the cyclic loading due to the rotation of the turbine rotor. Both turbines experience similar maximum rotor overspeeds. The slight differences observed are likely due to small changes in the shape of the extreme coherent gust as is propagates downstream. Finally, we see that the downwind turbine produces 96.46 KWh more energy than the upwind turbine. This is simply because the extremem coherent gust arrives at the downwind turbine ~70 seconds after it arrives at the upwind turbine. This allows the downwind turbine to generate electricity for an additional 70 seconds before experiencing an emergency overspeed shutdown.

\begin{table} \label{Table6-2}
\centering
\caption{Turbine performance metrics for the offset turbine test case without feed forward control.}
\begin{tabular}{c|cccccccccc}
\hline
\hline
                                                                &  & \begin{tabular}[c]{@{}c@{}}Tower base\\ DEL(MNm)\end{tabular} & & \begin{tabular}[c]{@{}c@{}}Blade root\\ DEL(MNm)\end{tabular} &  & \begin{tabular}[c]{@{}c@{}}Max\\ Overspeed(\%)\end{tabular} &  &  \begin{tabular}[c]{@{}c@{}}Energy\\ Gen.(kWh)\end{tabular}\\ 
\hline
\begin{tabular}[c]{@{}c@{}}Upwind \\ Turbine \end{tabular}      &  & 76.4                                                          & & 7.60                                                          &  & 15.37                                 				      &  &  237.54                                                     \\
\\
\begin{tabular}[c]{@{}c@{}}Downwind \\ Turbine \end{tabular}    &  & 75.2                                                          & & 9.15                                                          &  & 15.04                                                       &  &  334.00                                                     \\
\\
\hline
\hline                             
\end{tabular}
\end{table}


%-----------------------------------
%	SUBSECTION 6-6-3
%-----------------------------------
\subsection{Performance With Feed Forward Derating Control} \label{section6-6-3}

Figure \ref{fig6-20} shows wind speed in the computational domain at several key moments when feed forward derating control is enabled. The first few images in Figure \ref{fig6-20} look very similar to Figure \ref{fif6-14}. We see both turbines in a steady 12 m/s wind then we see the extreme coherent gust propagating through the computational domain and arriving at the upwind turbine. At t = 540 s we see the gust arriving at the downwind turbine and we see that the upwind turbine is no longer producing a wake, which indicates it has stopped operating. At t = 600 s we see a noteworthy difference between these simulation results and the results discussed in Subsection \ref{section6-6-2}. We see a wake trailing the downwind turbine. This indicates that it has not shut down in response to the extreme coherent gust.

 \begin{figure}[htbp] \label{fig6-20} 
	\centering
		\includegraphics[width = \linewidth]{Figures/ch6Figures/fig6-20.png}
		\rule{35em}{0.5pt}
	\caption{Wind speed near center of inlet during Extreme Coherent Gust (offset turbine test case).}
\end{figure}

Figures \ref{fig6-21} through \ref{fig6-25} show the rotor speed, power generation, blade pitch, blade root bending moment, and tower base fore-aft bending moment of the turbines. The Extreme Coherent Gust reaches the upwind turbine at approximately 450 s, causing both the rotor speed (Figure \ref{fig6-21}) and power generation (FIgure \ref{fig6-22}) to increase. At t = 469.7 s the rotor speed exceeds the 15\% overspeed limit and an emergency overspeed shutdown is initiated. At this point the feed forward derating control scheme described in Section \ref{section4-5} is initiated. A signal is sent to the downwind turbine instructing it to derate by 10.37\% beginning at t = 481.7 s and return to full rated operation at t = 627.2 s. Between t = 481.7 s and t = 511.7 s the downwind turbine smoothly reduces it's rotor speed and power generation. When the Extrem Coherent Gust arrives at approximately t = 520 s it does induce a spike in rotor speed, but the maximum overspeed is 6.9\% and it does not cause an emergency overspeed shutdown. Between t = 627.2 s and t = 657.2 s the downwind turbine transitions back to full rated operation.

\begin{figure}[htbp] \label{fig6-21}
	\centering
		\includegraphics[trim = {1cm 0 2cm 0}, clip, width = \linewidth]{Figures/ch6Figures/fig6-21.png}
		\rule{35em}{0.5pt}
	\caption{Center line velocity as ECG propagates through computational domain.}
\end{figure}
\begin{figure}[htbp] \label{fig6-22}
	\centering
		\includegraphics[trim = {1cm 0 2cm 0}, clip, width = \linewidth]{Figures/ch6Figures/fig6-22.png}
		\rule{35em}{0.5pt}
	\caption{Center line velocity as ECG propagates through computational domain.}
\end{figure}

Figure \ref{fig6-23} shows the blade pitch of the turbines. Initially, both turbines have a blade pitch of 4.8\degree. The Extremem Coherent Gust causes the blade pitch of the upwind turbine to increase to 90\degree. The initial increase in blade pitch is an attempt by the upwind turbine to maintain a rotor speed of 12.1 RPM. Once the emergency overspeed shutdown is initiated the upwind turbine's blade pitch increases to 90\degree at a rate of 8\degree/s to provide aerodynamic braking for the emergency shutdown. The blade pitch of the downwind turbine increases from 4.8\degree to 6.1\degree when the turbine is derated (starting at t = 481.7 s). The Extreme Coherent Gust causes an increase and some oscillation in downwind turbine blade pitch, with the blade pitch eventually settling to approximately 25.5\degree. The downwind turbine is the returned to full rated operation starting at t = 627.2 s, which decreases the blade pitch to 23.1\degree.

\begin{figure}[htbp] \label{fig6-23}
	\centering
		\includegraphics[trim = {1cm 0 2cm 0}, clip, width = \linewidth]{Figures/ch6Figures/fig6-23.png}
		\rule{35em}{0.5pt}
	\caption{Center line velocity as ECG propagates through computational domain.}
\end{figure}

Figures \ref{fig6-24} shows blade root bending moment (BRM). As we saw in the previous subsection, the BRM loading for the upwind turbine is cyclical and very consistent until the Extreme Coherent Gust arrives. The gust and the ensuing emergency shutdown cause a short period where the loading cycles have larger magnitudes and more irregular shapes. BRM loading for the downwind turbine is also cyclical and the cycles are very consistent in shape and magnitude. When the downwind turbine is derated starting at t = 481.7 s, the mean BRM decreases by approximately 12\% and the magnitude of the cyclical fluctuations in BRM increase by aproximately 9\%. These changes are primarily due to the increase in blade pitch caused by derating. When the Extremem Coherent Gust arrives and blade pitch is increased further the mean BRM decreases to approximately 3 MNm (~60\% below the initial mean BRM) and the cyclical fluctuations in BRM have increased to approximately 4 MNm (~140\% above the initial magnitude of fluctuations).

\begin{figure}[htbp] \label{fig6-24}
	\centering
		\includegraphics[trim = {1cm 0 2cm 0}, clip, width = \linewidth]{Figures/ch6Figures/fig6-24.png}
		\rule{35em}{0.5pt}
	\caption{Center line velocity as ECG propagates through computational domain.}
\end{figure}

In Figure \ref{fig6-25} we see that the tower base fore-aft bending moments is approximately 48 MNm with very little cyclical loading before the Extreme Coherent Gust arrives. The upwind turbine experiences a short period of cyclical loading, including one cycle with a very large magnitude, in response to the Extreme Coherent Gust and the ensuing emergency shutdown. The downwind turbine experiences a reduction in tower base fore-aft bending moment when the turbine is derated starting at t = 481.7 s. This is consistent with a reduction in aerodynamic loading on the turbine rotor due to increasing blade pitch. When the Extreme Coherent Gust arrives the downwind turbine sees a further reduction in the average tower base fore-aft bending moment. However, we see the introduction of a cyclic loading component that persists through the end of the simulation. If we zoom in on these high frequency oscillations we see that the loading has a very similar shape to the cyclic BRM loading seen in Figure \ref{fig6-23}, but has a frequency three times higher. Since the turbine rotor has three blades, this indicates that the higher magnitude BRM oscillations seen near the end of the simulation are causing the high frequency oscillations in tower loading. 

\begin{figure}[htbp] \label{fig6-25}
	\centering
		\includegraphics[trim = {1cm 0 2cm 0}, clip, width = \linewidth]{Figures/ch6Figures/fig6-16.png}
		\rule{35em}{0.5pt}
	\caption{Center line velocity as ECG propagates through computational domain.}
\end{figure}

Table \ref{table6-3} summarizes several important performance metrics for the turbines. As expected, the upwind turbine performance is identical to what was observed in the previous subsection. However, the downwind performance has changed. We see that the downwind turbine significantly out performs the upwind turbine in tower base fore-aft bending moment DEL, maximum overspeed, and energy generation. The downwind turbine performs a little worse that the upwind turbine in blade root bending moment DEL.

\begin{table} \label{Table6-3}
\centering
\caption{Turbine performance metrics for the offset turbine test case with selective derating feed forward control.}
\begin{tabular}{c|cccccccccc}
\hline
\hline
                                                                &  & \begin{tabular}[c]{@{}c@{}}Tower base\\ DEL(MNm)\end{tabular} & & \begin{tabular}[c]{@{}c@{}}Blade root\\ DEL(MNm)\end{tabular} &  & \begin{tabular}[c]{@{}c@{}}Max\\ Overspeed(\%)\end{tabular} &  &  \begin{tabular}[c]{@{}c@{}}Energy\\ Gen.(kWh)\end{tabular}\\ 
\hline
\begin{tabular}[c]{@{}c@{}}Upwind \\ Turbine \end{tabular}      &  & 76.4                                                          & & 7.60                                                          &  & 15.37                                 				      &  &  237.54                                                     \\
\\
\begin{tabular}[c]{@{}c@{}}Downwind \\ Turbine \end{tabular}    &  & 31.0                                                          & & 7.82                                                          &  &  6.90                                                       &  &  535.27                                                     \\
\\
\hline
\hline                             
\end{tabular}
\end{table}

We can isolate the effect of feed forward derating control and get more of an "apples to apples" comparison by comparing the performance of the downwind turbine in this simulation to the performance of the downwind turbine in the previous subsection. As Table \ref{Table6-4} shows, feed forward derating control improves turbine behaviour in all four of the performance metrics. Tower base fore-aft bending moment DEL has been reduced by 44.2 MNm, which is a reduction of 59\%. This is likely because the downwind turbine with feed forward derating control does not experience the very large magnitude loading cycles observed durring emergency shutdown. Blade root bending moment DEL has been reduced by 15\% despite the turbine operating for a longer period of time. In the previous subsection, when feed forward derating control was not enabled, the downwind turbine shut down and stopped accruing DEL at t = 539.2 s. Maximum overspeed has been reduced to 6.9\%, which will not induce an emergency shutdown. Energy generation has been increased by 201.27 KWh.

\begin{table} \label{Table6-4}
\centering
\caption{Effect of selective feed forward derating control on downwind turbine performance for the offset turbine test case.}
\begin{tabular}{c|cccccccccc}
\hline
\hline
                                                                 &  & \begin{tabular}[c]{@{}c@{}}Tower base\\ DEL(MNm)\end{tabular} & & \begin{tabular}[c]{@{}c@{}}Blade root\\ DEL(MNm)\end{tabular} &  & \begin{tabular}[c]{@{}c@{}}Max\\ Overspeed(\%)\end{tabular} &  &  \begin{tabular}[c]{@{}c@{}}Energy\\ Gen.(kWh)\end{tabular}\\ 
\hline
\begin{tabular}[c]{@{}c@{}}Without FF \\ Control \end{tabular}   &  & 75.2                                                          & & 9.15                                                          &  & 15.04                                 				       &  &  334.00                                                     \\
\\
\begin{tabular}[c]{@{}c@{}}With FF \\ Control \end{tabular}      &  & 31.0                                                          & & 7.82                                                          &  &  6.90                                                       &  &  535.27                                                     \\
\\
\begin{tabular}[c]{@{}c@{}}Change in\\Performance\end{tabular}   &  & -44.2 (-58.8\%)                                               & & -1.33 (-14.5%)                                                &  &  -8.14                                                      &  &  +201.27 (+60.2\%)                                                    \\
\\
\hline
\hline                             
\end{tabular}
\end{table}

 It is important to note that the difference in energy generation could be much larger in real world operation. These simulations end at t = 700 s, but beyond that time the downwind turbine with feed forward derating control would continue to generate 5 MW (or ~1.4 KWH per second). The downwind turbine without feed forward derating control would not generate any power until it was returned to service. That turbine may be shut down for much longer than the 149.5 seconds captured in these simulations.

%----------------------------------------------------------------------------------------
%	SECTION 7
%----------------------------------------------------------------------------------------
\section{Turbine in Wake Test Case} \label{section6-7}


\begin{equation} \label{eq6-4}
	U_{gust}=\left\{\begin{matrix}
\left [16.9991 +9.4109Cos\left ( \frac{r_g}{252 }\pi  \right )  \right ]m/s & for  & r_g<252\\ 
 \left [9.794 -2.2060Cos\left ( \frac{r_g-252}{63}\pi  \right )  \right ]m/s & for  & 252 \leq r_g <315\\ 
 12 m/s &  for & 315 \leq r_g
\end{matrix}\right. 
\end{equation}


\begin{table} \label{Table6-5}
\centering
\caption{ Extents and resolutions of the SOWFA grid refinement regions (distances extending from the center of the rotor).}
\begin{tabular}{c c c c c}
\hline
Refinement & Streamwise       & Radius     & Max Cell Size\\
Region     & Length(\emph{R}) & (\emph{R}) &  in Region\\
\hline
1          & 68.5\emph{R} (4316 m)  & 8.6\emph{R} (542 m) & 16 m $\times$ 16 m $\times$ 16 m\\
2          & 64.5\emph{R} (4064 m   & 4.6\emph{R} (290 m) & 8 m $\times$ 8 m $\times$ 8 m\\
3          & 46.5\emph{R} (2390 m)  & 2.6\emph{R} (164 m) & 4 m $\times$ 4 m $\times$ 4 m\\
4          & 33.5\emph{R} (2111 m)  & 1.6\emph{R} (101 m) & 2 m $\times$ 2 m $\times$ 2 m\\
\hline
\end{tabular}
\end{table}

%----------------------------------------------------------------------------------------
%	SECTION 8
%----------------------------------------------------------------------------------------

\section{Conclusions} \label{section6-8}

